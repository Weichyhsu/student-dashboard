<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆç¸¾åœ–è¡¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #fef7cd 0%, #fed7aa 50%, #fef3c7 100%);
            min-height: 100vh;
            color: #92400e;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(251, 191, 36, 0.3);
            border-radius: 24px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-box {
            width: 100%;
            max-width: 400px;
            padding: 40px;
            text-align: center;
        }

        .logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #f59e0b, #ea580c);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 32px;
            color: white;
            font-weight: bold;
        }

        .title {
            font-size: 32px;
            font-weight: bold;
            color: #92400e;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #b45309;
            margin-bottom: 30px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input {
            width: 100%;
            padding: 16px 24px;
            border: 1px solid rgba(251, 191, 36, 0.3);
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.8);
            color: #92400e;
            font-size: 16px;
            font-weight: 500;
            outline: none;
            transition: all 0.3s;
        }

        .input:focus {
            border-color: #f59e0b;
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
        }

        .btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #f59e0b, #ea580c);
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(245, 158, 11, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .info {
            margin-top: 20px;
            font-size: 14px;
            color: #b45309;
        }

        /* è¼‰å…¥å‹•ç•« */
        .loading {
            display: none;
            margin-top: 20px;
            color: #f59e0b;
        }

        .loading.show {
            display: block;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #f59e0b;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
            vertical-align: middle;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* å„€è¡¨æ¿æ¨£å¼ */
        .dashboard {
            display: none;
        }

        .header {
            padding: 30px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .header h1 {
            font-size: 36px;
            font-weight: bold;
            color: #92400e;
        }

        .header p {
            color: #b45309;
            margin-top: 5px;
            font-weight: 500;
        }

        .btn-secondary {
            padding: 12px 24px;
            background: rgba(251, 191, 36, 0.2);
            color: #92400e;
            border: 1px solid rgba(251, 191, 36, 0.3);
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-secondary:hover {
            background: rgba(251, 191, 36, 0.3);
            transform: scale(1.05);
        }

        /* ä¸»è¦å­¸ç¿’å“è³ªå¡ç‰‡ */
        .main-quality-card {
            margin-bottom: 30px;
            padding: 40px;
            text-align: center;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(34, 197, 94, 0.1));
            border: 2px solid rgba(16, 185, 129, 0.3);
            position: relative;
            overflow: hidden;
        }

        .main-quality-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(16, 185, 129, 0.1), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .quality-content {
            position: relative;
            z-index: 1;
        }

        .quality-title {
            font-size: 24px;
            font-weight: bold;
            color: #065f46;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .quality-score {
            font-size: 72px;
            font-weight: bold;
            color: #059669;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .quality-level {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            padding: 8px 16px;
            border-radius: 20px;
            display: inline-block;
        }

        .quality-description {
            font-size: 14px;
            color: #047857;
            line-height: 1.5;
        }

        /* å“è³ªç­‰ç´šé¡è‰² */
        .excellent { background: linear-gradient(135deg, #dcfce7, #bbf7d0); color: #065f46; }
        .good { background: linear-gradient(135deg, #dbeafe, #bfdbfe); color: #1e40af; }
        .average { background: linear-gradient(135deg, #fef3c7, #fde68a); color: #92400e; }
        .needs-improvement { background: linear-gradient(135deg, #fee2e2, #fecaca); color: #991b1b; }

        /* èªçŸ¥å±¤æ¬¡è‰²å½© - Bloom's Taxonomy */
        .cognitive-level-1 { background: linear-gradient(135deg, #fef3c7, #fed7aa); color: #92400e; } /* è¨˜æ†¶ */
        .cognitive-level-2 { background: linear-gradient(135deg, #fde68a, #fcd34d); color: #78350f; } /* ç†è§£ */
        .cognitive-level-3 { background: linear-gradient(135deg, #fcd34d, #fbbf24); color: #78350f; } /* æ‡‰ç”¨ */
        .cognitive-level-4 { background: linear-gradient(135deg, #fb923c, #f97316); color: #7c2d12; } /* åˆ†æ */
        .cognitive-level-5 { background: linear-gradient(135deg, #f87171, #ef4444); color: #7f1d1d; } /* è©•é‘‘ */
        .cognitive-level-6 { background: linear-gradient(135deg, #a78bfa, #8b5cf6); color: #4c1d95; } /* å‰µé€  */

        /* å•é¡Œå“è³ªè¦–è¦ºåŒ– */
        .cognitive-levels-card {
            padding: 30px;
            margin-bottom: 30px;
        }

        .levels-chart {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .level-item {
            text-align: center;
            padding: 20px;
            border-radius: 16px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .level-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            animation: pulse 2s infinite;
        }

        .level-item::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255,255,255,0.3);
            height: var(--percentage, 0%);
            transition: height 1s ease-out;
        }

        .level-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .level-name {
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
            position: relative;
            z-index: 1;
        }

        .level-count {
            font-size: 24px;
            font-weight: bold;
            position: relative;
            z-index: 1;
        }

        .level-percentage {
            font-size: 12px;
            opacity: 0.8;
            position: relative;
            z-index: 1;
        }

        /* å€‹äººåŒ–å­¸ç¿’å»ºè­° */
        .personalized-tips {
            padding: 30px;
            margin-bottom: 30px;
        }

        .tip-card {
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 16px;
            display: flex;
            align-items: flex-start;
            gap: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .tip-card:hover {
            transform: translateX(5px);
        }

        .tip-card.high-priority {
            background: linear-gradient(135deg, rgba(251, 146, 60, 0.1), rgba(251, 113, 133, 0.1));
            border: 2px solid rgba(251, 146, 60, 0.3);
        }

        .tip-card.medium-priority {
            background: linear-gradient(135deg, rgba(96, 165, 250, 0.1), rgba(147, 197, 253, 0.1));
            border: 2px solid rgba(96, 165, 250, 0.3);
        }

        .tip-card .icon {
            font-size: 24px;
            flex-shrink: 0;
        }

        .tip-content h4 {
            margin: 0 0 8px 0;
            color: #92400e;
            font-size: 16px;
        }

        .tip-content p {
            margin: 0;
            font-size: 14px;
            line-height: 1.5;
        }

        .code-example {
            background: #1e293b;
            color: #e2e8f0;
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }

        /* åæ€æ—¥èªŒ */
        .reflection-section {
            padding: 30px;
            margin-bottom: 30px;
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.05), rgba(16, 185, 129, 0.05));
            border: 2px solid rgba(16, 185, 129, 0.2);
        }

        .reflection-prompts {
            margin: 20px 0;
        }

        .reflection-prompt {
            padding: 15px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 12px;
            border-left: 4px solid #10b981;
            font-size: 14px;
            line-height: 1.6;
        }

        .btn-reflection {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-reflection:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3);
        }

        /* å­¸ç¿’è·¯å¾‘å»ºè­° */
        .learning-path-section {
            padding: 30px;
            margin-bottom: 30px;
        }

        .path-recommendation {
            padding: 25px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            border-radius: 16px;
            border: 2px solid rgba(99, 102, 241, 0.3);
            margin-top: 20px;
        }

        .path-title {
            font-size: 20px;
            font-weight: bold;
            color: #5b21b6;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .path-steps {
            display: grid;
            gap: 12px;
        }

        .path-step {
            padding: 12px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }

        .step-number {
            width: 30px;
            height: 30px;
            background: #6366f1;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        /* å‹•ç•«æ•ˆæœ */
        .animate-slide-in, .animate-slide-up {
            opacity: 0;
        }
        
        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes celebrate {
            0% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.1) rotate(10deg); }
            50% { transform: scale(1.2) rotate(-10deg); }
            75% { transform: scale(1.1) rotate(10deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        .animate-slide-in {
            animation: slideInLeft 0.6s ease-out;
        }

        .animate-slide-up {
            animation: slideInUp 0.6s ease-out;
        }

        .animate-pulse {
            animation: pulse 2s infinite;
        }

        .achievement-unlocked {
            animation: celebrate 0.8s ease-out;
        }

        /* æˆå°±é€šçŸ¥ */
        .achievement-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: none;
            z-index: 1000;
            max-width: 300px;
        }

        .achievement-notification.show {
            display: block;
            animation: slideInLeft 0.5s ease-out;
        }

        .achievement-icon {
            font-size: 48px;
            text-align: center;
            margin-bottom: 10px;
        }

        .achievement-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .achievement-desc {
            font-size: 14px;
            opacity: 0.9;
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 30px;
        }

        .kpi-card {
            padding: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .kpi-card:hover {
            transform: scale(1.05);
            background: rgba(255, 255, 255, 0.8);
        }

        .kpi-content h3 {
            font-size: 14px;
            color: #b45309;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .kpi-content .value {
            font-size: 48px;
            font-weight: bold;
            color: #92400e;
            margin-bottom: 5px;
        }

        .kpi-content .avg {
            font-size: 12px;
            color: #b45309;
            font-weight: 500;
        }

        .kpi-icon {
            width: 64px;
            height: 64px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            font-weight: bold;
        }

        .icon-blue { background: linear-gradient(135deg, #fad360, #fbcb38); }
        .icon-green { background: linear-gradient(135deg, #e6efa2, #e1f073); }
        .icon-purple { background: linear-gradient(135deg, #e0b5f6, #d996fb); }
        .icon-orange { background: linear-gradient(135deg, #fad264, #f9c946); }
        .icon-red { background: linear-gradient(135deg, #f8a071, #fc8d52); }
        .icon-amber { background: linear-gradient(135deg, #feb342, #fba92d); }

        .detail-section {
            padding: 30px;
            margin-bottom: 30px;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .detail-item {
            padding: 20px;
            background: rgba(251, 191, 36, 0.1);
            border-radius: 16px;
            border: 1px solid rgba(251, 191, 36, 0.2);
            text-align: center;
        }

        .detail-item h4 {
            color: #b45309;
            font-weight: 500;
            margin-bottom: 10px;
        }

        .detail-item .score {
            font-size: 32px;
            font-weight: bold;
            color: #92400e;
        }

        .summary {
            padding: 30px;
            text-align: center;
        }

        .summary-box {
            padding: 30px;
            background: rgba(251, 191, 36, 0.1);
            border-radius: 16px;
            border: 1px solid rgba(251, 191, 36, 0.2);
        }

        .summary-text {
            font-size: 20px;
            font-weight: bold;
            color: #92400e;
            margin-bottom: 10px;
        }

        .summary-detail {
            color: #b45309;
            margin-top: 10px;
        }

        .admin-section {
            display: none;
        }

        .connection-status {
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .status-success {
            background: rgba(16, 185, 129, 0.1);
            color: #065f46;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .status-error {
            background: rgba(239, 68, 68, 0.1);
            color: #991b1b;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .status-checking {
            background: rgba(59, 130, 246, 0.1);
            color: #1e40af;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        /* å­¸ç¿’å“è³ªåˆ†æåœ–è¡¨ */
        .quality-analysis {
            padding: 30px;
            margin-bottom: 30px;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .analysis-item {
            padding: 25px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 16px;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .analysis-item h4 {
            color: #1e40af;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .analysis-value {
            font-size: 28px;
            font-weight: bold;
            color: #1d4ed8;
            margin-bottom: 8px;
        }

        .analysis-desc {
            font-size: 13px;
            color: #3730a3;
            line-height: 1.4;
        }

        .error-message {
            background: rgba(239, 68, 68, 0.1);
            color: #991b1b;
            padding: 15px;
            border-radius: 12px;
            margin-top: 15px;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .update-time {
            font-size: 12px;
            color: #b45309;
            text-align: center;
            margin-top: 10px;
        }

        .hidden { display: none; }
        .block { display: block; }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .kpi-grid {
                grid-template-columns: 1fr;
            }
            
            .detail-grid {
                grid-template-columns: 1fr;
            }

            .analysis-grid {
                grid-template-columns: 1fr;
            }

            .quality-score {
                font-size: 56px;
            }
        }
    </style>
</head>
<body>
    <!-- ç™»å…¥é é¢ -->
    <div id="loginPage" class="login-container">
        <div class="glass login-box">
            <div class="logo"><img src="teacher.png" alt="logo" width="89" height="67"></div>
            <h1 class="title">æˆç¸¾åœ–è¡¨</h1>
            <p class="subtitle">è«‹è¼¸å…¥å­¸è™ŸæŸ¥çœ‹å­¸ç¿’é€²åº¦</p>
            
            <div class="input-group">
                <input type="text" id="studentInput" class="input" placeholder="è«‹è¼¸å…¥9ä½æ•¸å­¸è™Ÿ" maxlength="9" />
            </div>
            
            <button id="loginBtn" onclick="handleLogin()" class="btn">é€²å…¥æˆç¸¾åœ–è¡¨</button>
            
            <div class="loading" id="loginLoading">
                <span class="loading-spinner"></span>
                <span>è¼‰å…¥ä¸­...</span>
            </div>
            
            <div class="info">
                <p><strong>æˆç¸¾åœ–è¡¨ä¸­åŒ…å«:</strong><br>èªçŸ¥åƒèˆ‡åº¦åˆ†æã€èˆ‡å­¸ç¿’å¤¥ä¼´ä¹‹äº’å‹•æ¬¡æ•¸ã€èªçŸ¥æ€è€ƒåˆ†æ•¸ã€æ¸¬é©—æˆç¸¾ã€èª²ç¨‹å®Œæˆåº¦ã€å‡ºå¸­ç‡</p>
                <p style="margin-top: 10px; font-size: 12px; color: #047857;"><strong>âœ¨ è³‡æ–™å³æ™‚åŒæ­¥æ›´æ–°</strong></p>
                
                <div style="margin-top: 20px; padding: 15px; background: rgba(16, 185, 129, 0.1); border-radius: 12px; border: 1px solid rgba(16, 185, 129, 0.3);">
                    <p style="font-weight: bold; color: #065f46; margin-bottom: 8px;">ğŸ¯ æå‡èªçŸ¥åƒèˆ‡åº¦å°æŠ€å·§</p>
                    <p style="font-size: 12px; color: #047857; line-height: 1.4;">
                        é«˜èªçŸ¥åƒèˆ‡ = æ·±åº¦æ€è€ƒ + æœ‰æ•ˆäº’å‹•ï¼<br>
                        å°ˆæ³¨æ–¼ç†è§£å’Œæ‡‰ç”¨ï¼Œè€Œä¸åªæ˜¯å®Œæˆä»»å‹™ã€‚
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- ç®¡ç†å“¡é é¢ -->
    <div id="adminPage" class="login-container admin-section">
        <div class="glass login-box">
            <div class="logo" style="background: linear-gradient(135deg, #10b981, #059669);">ğŸ”‘</div>
            <h1 class="title">ç®¡ç†å“¡æ¨¡å¼</h1>
            <p class="subtitle">é€£ç·šæ¸¬è©¦èˆ‡ç³»çµ±ç‹€æ…‹</p>
            
            <div class="connection-status" id="connectionStatus">
                <div class="status-checking">
                    <span class="loading-spinner"></span>
                    <span>æ­£åœ¨æ¸¬è©¦é€£ç·š...</span>
                </div>
            </div>

            <div id="adminInfo" style="display: none;">
                <div style="padding: 20px; background: rgba(59, 130, 246, 0.1); border-radius: 12px; margin-bottom: 15px;">
                    <h3 style="color: #1e40af; margin-bottom: 10px;">ğŸ“Š ç³»çµ±ç‹€æ…‹</h3>
                    <p style="font-size: 14px; color: #3730a3;">
                        <strong>é€£ç·šç‹€æ…‹ï¼š</strong><span id="connectionState">æª¢æŸ¥ä¸­</span><br>
                        <strong>è³‡æ–™ä¾†æºï¼š</strong>Google Sheets<br>
                        <strong>æ›´æ–°é »ç‡ï¼š</strong>å³æ™‚<br>
                        <strong>å­¸ç”Ÿç¸½æ•¸ï¼š</strong><span id="totalStudentCount">0</span> äºº
                    </p>
                </div>

                <div style="padding: 15px; background: rgba(245, 158, 11, 0.1); border-radius: 12px; margin-bottom: 15px;">
                    <p style="font-size: 13px; color: #92400e;">
                        <strong>ğŸ”§ ç³»çµ±æç¤ºï¼š</strong><br>
                        è³‡æ–™æœƒå³æ™‚å¾ Google Sheets åŒæ­¥<br>
                        å­¸ç”Ÿç™»å…¥æ™‚æœƒè‡ªå‹•ç²å–æœ€æ–°è³‡æ–™
                    </p>
                </div>
            </div>

            <button onclick="goBackToLogin()" class="btn">è¿”å›ç™»å…¥é é¢</button>
        </div>
    </div>

    <!-- å„€è¡¨æ¿é é¢ -->
    <div id="dashboardPage" class="dashboard">
        <div class="container">
            <!-- Header -->
            <div class="glass header">
                <div>
                    <h1>æˆç¸¾åœ–è¡¨</h1>
                    <p>æ­¡è¿å›ä¾†ï¼Œ<span id="studentName" style="font-weight: bold;"></span> (<span id="studentId"></span>)</p>
                </div>
                <button onclick="goBackToLogin()" class="btn-secondary">é‡æ–°ç™»å…¥</button>
            </div>

            <!-- ä¸»è¦å­¸ç¿’å“è³ªå¡ç‰‡ -->
            <div class="glass main-quality-card">
                <div class="quality-content">
                    <div class="quality-title">
                        <span>ğŸ§ </span>
                        <span>èªçŸ¥åƒèˆ‡åº¦</span>
                        <span>ğŸ§ </span>
                    </div>
                    <div class="quality-score" id="qualityScore">0</div>
                    <div class="quality-level" id="qualityLevel">è¨ˆç®—ä¸­...</div>
                    <div class="quality-description" id="qualityDescription">æ­£åœ¨åˆ†ææ‚¨çš„å­¸ç¿’å“è³ª...</div>
                </div>
            </div>

            <!-- å­¸ç¿’å“è³ªåˆ†æ -->
            <div class="glass quality-analysis">
                <h2 style="font-size: 24px; font-weight: bold; color: #1e40af; margin-bottom: 5px;">ğŸ“Š èªçŸ¥åƒèˆ‡åº¦åˆ†æ</h2>
                <p style="color: #3730a3; margin-bottom: 20px;">æ·±åº¦äº†è§£æ‚¨çš„èªçŸ¥æŠ•å…¥æ¨¡å¼å’Œå­¸ç¿’ç­–ç•¥</p>
                <div class="analysis-grid">
                    <div class="analysis-item">
                        <h4><span>âš¡</span>äº’å‹•æ•ˆç‡</h4>
                        <div class="analysis-value" id="interactionEfficiency">0</div>
                        <div class="analysis-desc" id="efficiencyDesc">æ¯æ¬¡äº’å‹•çš„å¹³å‡èªçŸ¥æ”¶ç©«</div>
                    </div>
                    <div class="analysis-item">
                        <h4><span>ğŸ§ </span>æ€è€ƒæ·±åº¦</h4>
                        <div class="analysis-value" id="thinkingDepth">0</div>
                        <div class="analysis-desc" id="depthDesc">èªçŸ¥æ€è€ƒçš„è¤‡é›œç¨‹åº¦</div>
                    </div>
                    <div class="analysis-item">
                        <h4><span>ğŸ“ˆ</span>å­¸ç¿’ä¸€è‡´æ€§</h4>
                        <div class="analysis-value" id="learningConsistency">0</div>
                        <div class="analysis-desc" id="consistencyDesc">å­¸ç¿’è¡Œç‚ºçš„ç©©å®šæ€§</div>
                    </div>
                    <div class="analysis-item">
                        <h4><span>ğŸ¯</span>ç›®æ¨™é”æˆç‡</h4>
                        <div class="analysis-value" id="goalAchievement">0%</div>
                        <div class="analysis-desc" id="achievementDesc">ç¶œåˆå­¸ç¿’ç›®æ¨™å®Œæˆæƒ…æ³</div>
                    </div>
                </div>
            </div>

            <!-- å•é¡Œå“è³ªè¦–è¦ºåŒ–å„€è¡¨æ¿ -->
            <div class="glass cognitive-levels-card animate-slide-in">
                <h2 style="font-size: 24px; font-weight: bold; color: #5b21b6; margin-bottom: 5px;">ğŸ’¡ æˆ‘çš„æå•å“è³ªåˆ†æ</h2>
                <p style="color: #6d28d9; margin-bottom: 20px;">åŸºæ–¼ Bloom's Taxonomy èªçŸ¥å±¤æ¬¡åˆ†é¡</p>
                <div class="levels-chart">
                    <div class="level-item cognitive-level-1" style="--percentage: 15%;">
                        <div class="level-icon">ğŸ’­</div>
                        <span class="level-name">è¨˜æ†¶</span>
                        <span class="level-count">3é¡Œ</span>
                        <span class="level-percentage">15%</span>
                    </div>
                    <div class="level-item cognitive-level-2" style="--percentage: 25%;">
                        <div class="level-icon">ğŸ“–</div>
                        <span class="level-name">ç†è§£</span>
                        <span class="level-count">5é¡Œ</span>
                        <span class="level-percentage">25%</span>
                    </div>
                    <div class="level-item cognitive-level-3" style="--percentage: 30%;">
                        <div class="level-icon">âš™ï¸</div>
                        <span class="level-name">æ‡‰ç”¨</span>
                        <span class="level-count">6é¡Œ</span>
                        <span class="level-percentage">30%</span>
                    </div>
                    <div class="level-item cognitive-level-4" style="--percentage: 20%;">
                        <div class="level-icon">ğŸ”</div>
                        <span class="level-name">åˆ†æ</span>
                        <span class="level-count">4é¡Œ</span>
                        <span class="level-percentage">20%</span>
                    </div>
                    <div class="level-item cognitive-level-5" style="--percentage: 8%;">
                        <div class="level-icon">âš–ï¸</div>
                        <span class="level-name">è©•é‘‘</span>
                        <span class="level-count">2é¡Œ</span>
                        <span class="level-percentage">8%</span>
                    </div>
                    <div class="level-item cognitive-level-6" style="--percentage: 2%;">
                        <div class="level-icon">âœ¨</div>
                        <span class="level-name">å‰µé€ </span>
                        <span class="level-count">1é¡Œ</span>
                        <span class="level-percentage">2%</span>
                    </div>
                </div>
            </div>

            <!-- å€‹äººåŒ–å­¸ç¿’å»ºè­°å€ -->
            <div class="glass personalized-tips animate-slide-up">
                <h2 style="font-size: 24px; font-weight: bold; color: #ea580c; margin-bottom: 20px;">ğŸ“ å€‹äººåŒ– Python å­¸ç¿’å»ºè­°</h2>
                <div class="tip-card high-priority">
                    <span class="icon">ğŸš€</span>
                    <div class="tip-content">
                        <h4>æå‡æå•å±¤æ¬¡ï¼šå¾ã€Œæ‡‰ç”¨ã€åˆ°ã€Œåˆ†æã€</h4>
                        <p>æ‚¨å·²ç¶“æŒæ¡äº†åŸºæœ¬æ‡‰ç”¨ï¼Œç¾åœ¨å¯ä»¥å˜—è©¦åˆ†æç¨‹å¼ç¢¼çš„æ•ˆèƒ½å’Œçµæ§‹ã€‚</p>
                        <div class="code-example">
# è©¦è‘—å•ï¼šã€Œç‚ºä»€éº¼ä½¿ç”¨ list comprehension æ¯” for è¿´åœˆæ›´å¿«ï¼Ÿã€
# æˆ–ï¼šã€Œé€™å…©ç¨®æ’åºæ–¹æ³•çš„æ™‚é–“è¤‡é›œåº¦å·®ç•°æ˜¯ä»€éº¼ï¼Ÿã€
numbers = [x**2 for x in range(10)]  # vs for è¿´åœˆ</div>
                    </div>
                </div>
                <div class="tip-card medium-priority">
                    <span class="icon">ğŸ’¡</span>
                    <div class="tip-content">
                        <h4>æ¢ç´¢ Python é€²éšæ¦‚å¿µ</h4>
                        <p>æ‚¨çš„äº’å‹•é »ç‡å¾ˆå¥½ï¼å»ºè­°æ·±å…¥äº†è§£è£é£¾å™¨ã€ç”Ÿæˆå™¨ç­‰é€²éšä¸»é¡Œã€‚</p>
                        <div class="code-example">
# å¯ä»¥å• LINE botï¼šã€Œå¦‚ä½•ä½¿ç”¨è£é£¾å™¨ä¾†è¨ˆç®—å‡½æ•¸åŸ·è¡Œæ™‚é–“ï¼Ÿã€
@timer_decorator
def my_function():
    pass</div>
                    </div>
                </div>
                <div class="tip-card medium-priority">
                    <span class="icon">ğŸ¯</span>
                    <div class="tip-content">
                        <h4>å‰µé€ æ€§æ€è€ƒç·´ç¿’</h4>
                        <p>æŒ‘æˆ°è‡ªå·±è¨­è¨ˆå°å°ˆæ¡ˆï¼Œçµåˆä¸åŒæ¦‚å¿µå‰µé€ æ–°çš„è§£æ±ºæ–¹æ¡ˆã€‚</p>
                        <div class="code-example">
# å‰µé€ å±¤æ¬¡æå•ï¼šã€Œå¦‚ä½•è¨­è¨ˆä¸€å€‹ Python é¡åˆ¥ä¾†æ¨¡æ“¬éŠ€è¡Œå¸³æˆ¶ç³»çµ±ï¼Ÿã€</div>
                    </div>
                </div>
            </div>

            <!-- å­¸ç¿’è·¯å¾‘å»ºè­° -->
            <div class="glass learning-path-section">
                <h2 style="font-size: 24px; font-weight: bold; color: #7c3aed; margin-bottom: 5px;">ğŸ—ºï¸ æ‚¨çš„å°ˆå±¬å­¸ç¿’è·¯å¾‘</h2>
                <div class="path-recommendation">
                    <div class="path-title">
                        <span>ğŸ“š</span>
                        <span>å»ºè­°è·¯å¾‘ï¼šè³ªé‡ä¸¦é‡å‹å­¸ç¿’è€…</span>
                    </div>
                    <div class="path-steps">
                        <div class="path-step">
                            <span class="step-number">1</span>
                            <span>æ¯å¤©è‡³å°‘æå‡º 2 å€‹ã€Œåˆ†æã€å±¤æ¬¡ä»¥ä¸Šçš„å•é¡Œ</span>
                        </div>
                        <div class="path-step">
                            <span class="step-number">2</span>
                            <span>é€±æœ«èŠ± 30 åˆ†é˜å›é¡§æœ¬é€±å­¸ç¿’é‡é»ï¼Œæ•´ç†ç­†è¨˜</span>
                        </div>
                        <div class="path-step">
                            <span class="step-number">3</span>
                            <span>æŒ‘æˆ°è‡ªå·±ï¼šæ¯é€±å®Œæˆä¸€å€‹çµåˆå¤šå€‹æ¦‚å¿µçš„å°å°ˆæ¡ˆ</span>
                        </div>
                        <div class="path-step">
                            <span class="step-number">4</span>
                            <span>èˆ‡åŒå­¸åˆ†äº«ä½ çš„ç¨‹å¼ç¢¼ï¼Œäº’ç›¸çµ¦äºˆå›é¥‹</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- åæ€æ—¥èªŒ -->
            <div class="glass reflection-section">
                <h2 style="font-size: 24px; font-weight: bold; color: #059669; margin-bottom: 20px;">ğŸ“ æœ¬é€±å­¸ç¿’åæ€</h2>
                <div class="reflection-prompts">
                    <div class="reflection-prompt">
                        <strong>ğŸ’¡ é€™é€±æˆ‘å­¸åˆ°æœ€é‡è¦çš„ Python æ¦‚å¿µæ˜¯...</strong><br>
                        ä¾‹å¦‚ï¼šç†è§£äº†å‡½æ•¸åƒæ•¸çš„å‚³éæ–¹å¼ï¼ˆpass by reference vs valueï¼‰
                    </div>
                    <div class="reflection-prompt">
                        <strong>ğŸ¤” æˆ‘é‡åˆ°çš„å›°é›£å’Œè§£æ±ºæ–¹æ³•...</strong><br>
                        ä¾‹å¦‚ï¼šéè¿´å‡½æ•¸å¾ˆé›£ç†è§£ï¼Œé€éç•«åœ–è¿½è¹¤åŸ·è¡Œæµç¨‹å¾Œè±ç„¶é–‹æœ—
                    </div>
                    <div class="reflection-prompt">
                        <strong>ğŸ¯ ä¸‹é€±æˆ‘æƒ³æ·±å…¥æ¢è¨...</strong><br>
                        ä¾‹å¦‚ï¼šæƒ³äº†è§£å¦‚ä½•ä½¿ç”¨ Python è™•ç†æª”æ¡ˆå’Œä¾‹å¤–è™•ç†
                    </div>
                </div>
                <button class="btn-reflection" onclick="sendToLineBot()">
                    <span style="margin-right: 8px;">ğŸ“¤</span>
                    è¨˜éŒ„åˆ° LINE bot
                </button>
                <p style="margin-top: 15px; font-size: 13px; color: #047857; text-align: center;">
                    é»æ“Šå¾Œæœƒé–‹å•Ÿ LINEï¼Œå°‡åæ€å…§å®¹å‚³é€çµ¦ Python å­¸ç¿’ Bot<br>
                    <span style="font-size: 12px; opacity: 0.8;">ğŸ’¡ æç¤ºï¼šBot æœƒæ ¹æ“šæ‚¨çš„åæ€æä¾›å€‹äººåŒ–å­¸ç¿’å»ºè­°</span>
                </p>
            </div>

            <!-- KPI Cards -->
            <div class="kpi-grid">
                <div class="glass kpi-card">
                    <div class="kpi-content">
                        <h3>å­¸ç¿’é€²æ­¥å¹…åº¦</h3>
                        <div class="value" id="improvement">0</div>
                        <div class="avg">å‰æ¸¬â†’å¾Œæ¸¬</div>
                    </div>
                    <div class="kpi-icon" id="improvementIcon">ğŸ“ˆ</div>
                </div>

                <div class="glass kpi-card">
                    <div class="kpi-content">
                        <h3>ç­ç´šæ’å</h3>
                        <div class="value" id="classRank">0</div>
                        <div class="avg">å…± <span id="totalStudents">0</span> äºº</div>
                    </div>
                    <div class="kpi-icon icon-purple">ğŸ‘¥</div>
                </div>

                <div class="glass kpi-card">
                    <div class="kpi-content">
                        <h3>èªçŸ¥æ€è€ƒåˆ†æ•¸</h3>
                        <div class="value" id="cognitiveScore">0</div>
                        <div class="avg">ç­ç´šå¹³å‡: <span id="avgCognitive">0</span></div>
                    </div>
                    <div class="kpi-icon icon-green">ğŸ§ </div>
                </div>

                <div class="glass kpi-card">
                    <div class="kpi-content">
                        <h3>å®Œæˆåº¦</h3>
                        <div class="value" id="completionRate">0%</div>
                        <div class="avg">ç­ç´šå¹³å‡: <span id="avgCompletion">0%</span></div>
                    </div>
                    <div class="kpi-icon icon-blue">âœ…</div>
                </div>
            </div>

            <!-- è©³ç´°å­¸ç¿’è³‡æ–™ -->
            <div class="glass detail-section">
                <h2 style="font-size: 24px; font-weight: bold; color: #92400e; margin-bottom: 20px;">ğŸ“‹ è©³ç´°å­¸ç¿’è³‡æ–™</h2>
                <div class="detail-grid">
                    <div class="detail-item">
                        <h4>å‰æ¸¬æˆç¸¾</h4>
                        <div class="score" id="preTestScore">--</div>
                    </div>
                    <div class="detail-item">
                        <h4>å¾Œæ¸¬æˆç¸¾</h4>
                        <div class="score" id="postTestScore">--</div>
                    </div>
                    <div class="detail-item">
                        <h4>äº’å‹•æ¬¡æ•¸</h4>
                        <div class="score" id="detailInteractionCount">0</div>
                    </div>
                    <div class="detail-item">
                        <h4>å‡ºå¸­ç‡</h4>
                        <div class="score" id="attendanceRate">0%</div>
                    </div>
                </div>
            </div>

            <!-- å­¸ç¿’ç¸½çµ -->
            <div class="glass summary">
                <h2 style="font-size: 24px; font-weight: bold; color: #92400e; margin-bottom: 20px;">ğŸ‰ å­¸ç¿’æˆæ•ˆç¸½çµ</h2>
                <div class="summary-box">
                    <div class="summary-text" id="summaryText">è¼‰å…¥ä¸­...</div>
                    <div class="summary-detail" id="summaryDetail">è¼‰å…¥ä¸­...</div>
                </div>
                <div class="update-time" id="updateTime"></div>
            </div>
        </div>
    </div>

    <!-- æˆå°±é€šçŸ¥ -->
    <div class="achievement-notification" id="achievementNotification">
        <div class="achievement-icon">ğŸ†</div>
        <div class="achievement-title" id="achievementTitle">æ–°æˆå°±è§£é–ï¼</div>
        <div class="achievement-desc" id="achievementDesc">æ‚¨å·²ç¶“é”æˆäº†æŸé …æˆå°±</div>
    </div>

    <script>
        // Google Apps Script Web App URL
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwpk38QGjiGSv0UwsfoGSolqAmCGAO3NCfz3vVCpPB9pi3uMNmNFGlCByvgPzYkJE8EUg/exec';
        
        // å…¨åŸŸè®Šæ•¸
        let classData = {};
        let currentStudentId = null;

        // å®‰å…¨æ›´æ–°å…ƒç´ å…§å®¹çš„è¼”åŠ©å‡½æ•¸
        function safeUpdateElement(selector, value, isId = true) {
            const element = isId ? document.getElementById(selector) : document.querySelector(selector);
            if (element) {
                element.textContent = value;
                return true;
            } else {
                console.warn(`æ‰¾ä¸åˆ°å…ƒç´ : ${selector}`);
                return false;
            }
        }

        // å¾ Apps Script ç²å–è³‡æ–™
        async function fetchDataFromAppsScript(action, studentId = null) {
            try {
                let url = `${WEB_APP_URL}?action=${action}`;
                if (studentId) {
                    url += `&studentId=${studentId}`;
                }
                
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                return data;
            } catch (error) {
                console.error('ç²å–è³‡æ–™éŒ¯èª¤:', error);
                throw error;
            }
        }

        // è¨ˆç®—èªçŸ¥åƒèˆ‡åº¦çš„å‡½æ•¸
        function calculateCognitiveEngagement(student) {
            const interactionCount = student.äº’å‹•æ¬¡æ•¸ || 0;
            const cognitiveScore = student.èªçŸ¥æ€è€ƒåˆ†æ•¸ || 0;
            const completionRate = parseFloat(student.å®Œæˆåº¦) || 0;
            const attendanceRate = parseFloat(student.å‡ºå¸­ç‡) || 0;
            
            // èªçŸ¥åƒèˆ‡åº¦è¨ˆç®—å…¬å¼
            const baseScore = cognitiveScore * 0.4;
            const interactionEfficiency = Math.min((cognitiveScore / Math.max(interactionCount, 1)) * 10, 30) * 0.3;
            const completionBonus = completionRate * 0.2;
            const attendanceBonus = attendanceRate * 0.1;
            
            const engagementScore = Math.round(baseScore + interactionEfficiency + completionBonus + attendanceBonus);
            
            return {
                score: engagementScore,
                efficiency: Math.round((cognitiveScore / Math.max(interactionCount, 1)) * 100) / 100,
                baseScore,
                interactionEfficiency,
                completionBonus,
                attendanceBonus
            };
        }

        // ç²å–èªçŸ¥åƒèˆ‡åº¦ç­‰ç´šå’Œæè¿°
        function getEngagementLevel(score) {
            if (score >= 85) {
                return {
                    level: "é«˜åº¦èªçŸ¥åƒèˆ‡",
                    class: "excellent",
                    description: "æ‚¨å±•ç¾äº†å“è¶Šçš„èªçŸ¥åƒèˆ‡åº¦ï¼æ·±åº¦æ€è€ƒèˆ‡æœ‰æ•ˆäº’å‹•è®“æ‚¨åœ¨å­¸ç¿’ä¸­è¡¨ç¾å‡ºè‰²ã€‚"
                };
            } else if (score >= 70) {
                return {
                    level: "è‰¯å¥½èªçŸ¥åƒèˆ‡",
                    class: "good",
                    description: "æ‚¨çš„èªçŸ¥åƒèˆ‡åº¦è‰¯å¥½ï¼Œåœ¨æ€è€ƒæ·±åº¦å’Œå­¸ç¿’ç­–ç•¥é‹ç”¨ä¸Šå–å¾—äº†å¹³è¡¡ã€‚"
                };
            } else if (score >= 55) {
                return {
                    level: "ç©©å®šèªçŸ¥åƒèˆ‡",
                    class: "average",
                    description: "æ‚¨çš„èªçŸ¥åƒèˆ‡è¡¨ç¾ç©©å®šï¼Œå¯ä»¥å˜—è©¦æé«˜æ€è€ƒæ·±åº¦ä¾†æå‡å­¸ç¿’æ•ˆæœã€‚"
                };
            } else {
                return {
                    level: "ç™¼å±•ä¸­èªçŸ¥åƒèˆ‡",
                    class: "needs-improvement",
                    description: "æ‚¨æ­£åœ¨ç™¼å±•èªçŸ¥åƒèˆ‡èƒ½åŠ›ï¼å»ºè­°å¤šé€²è¡Œæ·±åº¦æ€è€ƒå’Œä¸»å‹•å­¸ç¿’ã€‚"
                };
            }
        }

        // è¨ˆç®—ç­ç´šå¹³å‡å€¼
        function calculateClassAverage(allStudents) {
            if (!allStudents || allStudents.length === 0) {
                return { cognitiveScore: 0, completionRate: 0, engagementScore: 0 };
            }
            
            const count = allStudents.length;
            const avgEngagement = allStudents.reduce((sum, s) => sum + calculateCognitiveEngagement(s).score, 0) / count;
            
            return {
                cognitiveScore: Math.round(allStudents.reduce((sum, s) => sum + (s.èªçŸ¥æ€è€ƒåˆ†æ•¸ || 0), 0) / count),
                completionRate: Math.round(allStudents.reduce((sum, s) => sum + (parseFloat(s.å®Œæˆåº¦) || 0), 0) / count),
                engagementScore: Math.round(avgEngagement)
            };
        }

        // è™•ç†ç™»å…¥
        async function handleLogin() {
            const studentId = document.getElementById('studentInput').value.trim();
            const loginBtn = document.getElementById('loginBtn');
            const loginLoading = document.getElementById('loginLoading');
            
            // ç®¡ç†å“¡å…¥å£
            if (studentId === '165540') {
                showAdminPage();
                return;
            }
            
            // æª¢æŸ¥å­¸è™Ÿæ ¼å¼ï¼ˆ9ä½æ•¸å­—ï¼‰
            if (!/^\d{9}$/.test(studentId)) {
                alert('è«‹è¼¸å…¥æ­£ç¢ºçš„9ä½æ•¸å­¸è™Ÿ');
                return;
            }
            
            // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
            loginBtn.disabled = true;
            loginLoading.classList.add('show');
            
            try {
                // å¾ Apps Script ç²å–å­¸ç”Ÿè³‡æ–™
                const response = await fetchDataFromAppsScript('getStudent', studentId);
                
                if (response.success && response.student) {
                    // å„²å­˜å­¸è™Ÿä¾›é‡æ–°è¼‰å…¥ä½¿ç”¨
                    currentStudentId = studentId;
                    
                    // é¡¯ç¤ºå„€è¡¨æ¿
                    showDashboard(response.student, response.allStudents);
                } else {
                    alert('æŸ¥ç„¡æ­¤å­¸è™Ÿçš„è³‡æ–™ï¼Œè«‹ç¢ºèªå¾Œé‡æ–°è¼¸å…¥æˆ–è¯ç¹«è€å¸«');
                }
            } catch (error) {
                console.error('ç™»å…¥éŒ¯èª¤:', error);
                alert('é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šæˆ–ç¨å¾Œå†è©¦');
            } finally {
                loginBtn.disabled = false;
                loginLoading.classList.remove('show');
            }
        }

        // é¡¯ç¤ºç®¡ç†å“¡é é¢
        async function showAdminPage() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('adminPage').style.display = 'flex';
            document.getElementById('dashboardPage').style.display = 'none';
            
            // æ¸¬è©¦é€£ç·š
            const connectionStatus = document.getElementById('connectionStatus');
            
            try {
                const response = await fetchDataFromAppsScript('testConnection');
                
                if (response.success) {
                    connectionStatus.className = 'connection-status status-success';
                    connectionStatus.innerHTML = `
                        <div style="font-size: 24px; margin-bottom: 10px;">âœ…</div>
                        <div style="font-weight: bold;">é€£ç·šæˆåŠŸï¼</div>
                        <div style="font-size: 14px; margin-top: 5px;">å·²æˆåŠŸé€£æ¥åˆ° Google Sheets</div>
                    `;
                    
                    // é¡¯ç¤ºç³»çµ±è³‡è¨Š
                    const adminInfo = document.getElementById('adminInfo');
                    if (adminInfo) {
                        adminInfo.style.display = 'block';
                    }
                    safeUpdateElement('connectionState', 'æ­£å¸¸');
                    safeUpdateElement('totalStudentCount', response.studentCount || 0);
                } else {
                    throw new Error('é€£ç·šæ¸¬è©¦å¤±æ•—');
                }
            } catch (error) {
                connectionStatus.className = 'connection-status status-error';
                connectionStatus.innerHTML = `
                    <div style="font-size: 24px; margin-bottom: 10px;">âŒ</div>
                    <div style="font-weight: bold;">é€£ç·šå¤±æ•—</div>
                    <div style="font-size: 14px; margin-top: 5px;">è«‹æª¢æŸ¥ Apps Script è¨­å®š</div>
                `;
            }
        }

        // è¿”å›ç™»å…¥é é¢
        function goBackToLogin() {
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('adminPage').style.display = 'none';
            document.getElementById('dashboardPage').style.display = 'none';
            document.getElementById('studentInput').value = '';
            currentStudentId = null;
        }

        // é¡¯ç¤ºå­¸ç”Ÿå„€è¡¨æ¿
        function showDashboard(student, allStudents) {
            try {
                console.log('é–‹å§‹é¡¯ç¤ºå„€è¡¨æ¿ï¼Œå­¸ç”Ÿè³‡æ–™:', student);
                
                const classAvg = calculateClassAverage(allStudents);
                const engagementData = calculateCognitiveEngagement(student);
                const engagementInfo = getEngagementLevel(engagementData.score);
                
                // æ›´æ–°é é¢é¡¯ç¤º
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('adminPage').style.display = 'none';
                document.getElementById('dashboardPage').style.display = 'block';

                // ç¢ºä¿å„€è¡¨æ¿å·²ç¶“é¡¯ç¤ºå¾Œå†æ›´æ–°å…§å®¹
                setTimeout(() => {
                    updateDashboardContent(student, allStudents, classAvg, engagementData, engagementInfo);
                }, 100);
                
            } catch (error) {
                console.error('é¡¯ç¤ºå„€è¡¨æ¿æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                alert('é¡¯ç¤ºè³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹é‡æ–°æ•´ç†é é¢å†è©¦');
            }
        }
        
        // æ›´æ–°å„€è¡¨æ¿å…§å®¹
        function updateDashboardContent(student, allStudents, classAvg, engagementData, engagementInfo) {

            // æ›´æ–°åŸºæœ¬è³‡è¨Š
            safeUpdateElement('studentName', student.å§“å || 'å­¸ç”Ÿ');
            safeUpdateElement('studentId', student.å­¸è™Ÿ);

            // æ›´æ–°ä¸»è¦èªçŸ¥åƒèˆ‡åº¦å¡ç‰‡
            const qualityScoreElement = document.getElementById('qualityScore');
            if (qualityScoreElement) {
                qualityScoreElement.textContent = engagementData.score;
                
                // å¦‚æœåˆ†æ•¸å„ªç§€ï¼ŒåŠ å…¥æ…¶ç¥å‹•ç•«
                if (engagementData.score >= 85) {
                    qualityScoreElement.classList.add('animate-pulse');
                }
            }
            
            const qualityLevelElement = document.getElementById('qualityLevel');
            if (qualityLevelElement) {
                qualityLevelElement.textContent = engagementInfo.level;
                qualityLevelElement.className = `quality-level ${engagementInfo.class}`;
            }
            
            const qualityDescElement = document.getElementById('qualityDescription');
            if (qualityDescElement) {
                qualityDescElement.textContent = engagementInfo.description;
            }

            // æ›´æ–°èªçŸ¥åƒèˆ‡åº¦åˆ†æ
            safeUpdateElement('interactionEfficiency', engagementData.efficiency);
            
            // æ€è€ƒæ·±åº¦
            const thinkingDepth = student.èªçŸ¥æ€è€ƒåˆ†æ•¸ >= 80 ? "æ·±åº¦" : 
                                  student.èªçŸ¥æ€è€ƒåˆ†æ•¸ >= 60 ? "ä¸­ç­‰" : "åŸºç¤";
            safeUpdateElement('thinkingDepth', thinkingDepth);
            
            // å­¸ç¿’ä¸€è‡´æ€§
            const consistency = Math.round((parseFloat(student.å®Œæˆåº¦) + parseFloat(student.å‡ºå¸­ç‡)) / 2);
            safeUpdateElement('learningConsistency', `${consistency}%`);
            
            // ç›®æ¨™é”æˆç‡
            const postTestForGoal = parseFloat(student.å¾Œæ¸¬æˆç¸¾) || 0;
            const completion = parseFloat(student.å®Œæˆåº¦) || 0;
            const goalAchievement = Math.round((postTestForGoal + completion) / 2);
            safeUpdateElement('goalAchievement', `${goalAchievement}%`);

            // æ›´æ–°åˆ†ææè¿°
            safeUpdateElement('efficiencyDesc',
                engagementData.efficiency >= 1.0 ? "é«˜æ•ˆå­¸ç¿’ï¼Œæ¯æ¬¡äº’å‹•éƒ½æœ‰æ”¶ç©«" :
                engagementData.efficiency >= 0.7 ? "å­¸ç¿’æ•ˆç‡è‰¯å¥½ï¼Œå¯æŒçºŒä¿æŒ" :
                "å»ºè­°æå‡äº’å‹•å“è³ªï¼Œæ·±åº¦æ€è€ƒ");

            safeUpdateElement('depthDesc',
                student.èªçŸ¥æ€è€ƒåˆ†æ•¸ >= 80 ? "å±•ç¾å‡ºè‰²çš„æ‰¹åˆ¤æ€§æ€ç¶­" :
                student.èªçŸ¥æ€è€ƒåˆ†æ•¸ >= 60 ? "æ€è€ƒèƒ½åŠ›ç™¼å±•ç©©å®š" :
                "å¯ä»¥å˜—è©¦æ›´æ·±å…¥çš„æ€è€ƒ");

            safeUpdateElement('consistencyDesc',
                consistency >= 90 ? "å­¸ç¿’è¡Œç‚ºéå¸¸ç©©å®š" :
                consistency >= 70 ? "å­¸ç¿’ç¿’æ…£è‰¯å¥½" :
                "å»ºè­°æå‡å­¸ç¿’è¦å¾‹æ€§");

            safeUpdateElement('achievementDesc',
                goalAchievement >= 80 ? "å„ªç§€åœ°é”æˆå­¸ç¿’ç›®æ¨™" :
                goalAchievement >= 60 ? "ç©©æ­¥é”æˆå­¸ç¿’ç›®æ¨™" :
                "éœ€è¦æ›´å¤šåŠªåŠ›é”æˆç›®æ¨™");

            // æ›´æ–°å•é¡Œå“è³ªåˆ†æï¼ˆåŸºæ–¼èªçŸ¥æ€è€ƒåˆ†æ•¸åˆ†å¸ƒï¼‰
            try {
                updateCognitiveLevels(student);
            } catch (error) {
                console.error('æ›´æ–°èªçŸ¥å±¤æ¬¡å¤±æ•—:', error);
            }
            
            // æ›´æ–°å€‹äººåŒ–å»ºè­°
            try {
                updatePersonalizedTips(student, engagementData);
            } catch (error) {
                console.error('æ›´æ–°å€‹äººåŒ–å»ºè­°å¤±æ•—:', error);
            }
            
            // æ›´æ–°å­¸ç¿’è·¯å¾‘
            try {
                updateLearningPath(student, engagementData);
            } catch (error) {
                console.error('æ›´æ–°å­¸ç¿’è·¯å¾‘å¤±æ•—:', error);
            }

            // è¨ˆç®—ç­ç´šæ’å
            const sortedStudents = allStudents
                .map(s => ({ ...s, engagementScore: calculateCognitiveEngagement(s).score }))
                .sort((a, b) => b.engagementScore - a.engagementScore);
            const rank = sortedStudents.findIndex(s => s.å­¸è™Ÿ === student.å­¸è™Ÿ) + 1;

            // æ›´æ–°KPIå¡ç‰‡
            const preTestScore = parseFloat(student.å‰æ¸¬æˆç¸¾) || 0;
            const postTestScore = parseFloat(student.å¾Œæ¸¬æˆç¸¾) || 0;
            const improvement = postTestScore - preTestScore;
            safeUpdateElement('improvement', improvement > 0 ? `+${improvement}` : improvement);
            
            const improvementIcon = document.getElementById('improvementIcon');
            if (improvementIcon) {
                if (improvement > 0) {
                    improvementIcon.className = 'kpi-icon icon-green';
                    improvementIcon.textContent = 'ğŸ“ˆ';
                } else if (improvement < 0) {
                    improvementIcon.className = 'kpi-icon icon-red';
                    improvementIcon.textContent = 'ğŸ“‰';
                } else {
                    improvementIcon.className = 'kpi-icon icon-amber';
                    improvementIcon.textContent = 'â¡ï¸';
                }
            }
            
            safeUpdateElement('classRank', rank);
            safeUpdateElement('totalStudents', allStudents.length);
            
            safeUpdateElement('cognitiveScore', student.èªçŸ¥æ€è€ƒåˆ†æ•¸ || 0);
            safeUpdateElement('avgCognitive', classAvg.cognitiveScore || 0);
            
            const completionRate = student.å®Œæˆåº¦ || "0";
            safeUpdateElement('completionRate', `${completionRate}%`);
            safeUpdateElement('avgCompletion', `${classAvg.completionRate || 0}%`);

            // æ›´æ–°è©³ç´°è³‡æ–™
            safeUpdateElement('preTestScore', student.å‰æ¸¬æˆç¸¾ || '--');
            safeUpdateElement('postTestScore', student.å¾Œæ¸¬æˆç¸¾ || '--');
            safeUpdateElement('detailInteractionCount', student.äº’å‹•æ¬¡æ•¸ || 0);
            safeUpdateElement('attendanceRate', `${student.å‡ºå¸­ç‡ || "0"}%`);

            // æ›´æ–°ç¸½çµ
            let summaryText, summaryDetail;
            
            if (engagementData.score >= 85) {
                summaryText = `ğŸ† å„ªç§€ï¼æ‚¨çš„èªçŸ¥åƒèˆ‡åº¦ç‚º ${engagementData.score}ï¼Œè¡¨ç¾å“è¶Šï¼`;
                summaryDetail = `æ‚¨åœ¨ç­ç´šä¸­æ’åç¬¬${rank}åï¼Œå±•ç¾äº†é«˜åº¦çš„èªçŸ¥åƒèˆ‡èƒ½åŠ›ã€‚`;
            } else if (engagementData.score >= 70) {
                summaryText = `ğŸŒŸ å¾ˆå¥½ï¼æ‚¨çš„èªçŸ¥åƒèˆ‡åº¦ç‚º ${engagementData.score}ï¼ŒæŒçºŒä¿æŒï¼`;
                summaryDetail = `æ‚¨åœ¨ç­ç´šä¸­æ’åç¬¬${rank}åï¼ŒèªçŸ¥åƒèˆ‡åº¦è‰¯å¥½ã€‚`;
            } else if (engagementData.score >= 55) {
                summaryText = `ğŸ“š ä¸éŒ¯ï¼æ‚¨çš„èªçŸ¥åƒèˆ‡åº¦ç‚º ${engagementData.score}ï¼Œé‚„æœ‰æå‡ç©ºé–“ã€‚`;
                summaryDetail = `æ‚¨åœ¨ç­ç´šä¸­æ’åç¬¬${rank}åï¼Œå¯ä»¥å˜—è©¦æå‡æ€è€ƒæ·±åº¦ã€‚`;
            } else {
                summaryText = `ğŸ’ª åŠ æ²¹ï¼æ‚¨çš„èªçŸ¥åƒèˆ‡åº¦ç‚º ${engagementData.score}ï¼ŒæŒçºŒåŠªåŠ›ï¼`;
                summaryDetail = `æ‚¨åœ¨ç­ç´šä¸­æ’åç¬¬${rank}åï¼Œå»ºè­°å¤šé€²è¡Œæ·±åº¦å­¸ç¿’ã€‚`;
            }
            
            safeUpdateElement('summaryText', summaryText);
            safeUpdateElement('summaryDetail', summaryDetail);
            
            // æ›´æ–°æ™‚é–“
            const now = new Date();
            safeUpdateElement('updateTime', 
                `è³‡æ–™æ›´æ–°æ™‚é–“ï¼š${now.toLocaleDateString('zh-TW')} ${now.toLocaleTimeString('zh-TW')}`);
            
            // æª¢æŸ¥ä¸¦é¡¯ç¤ºæˆå°±
            checkAchievements(student, engagementData);
            
            // åŠ å…¥å‹•ç•«æ•ˆæœ
            setTimeout(() => {
                document.querySelectorAll('.animate-slide-in').forEach((el, index) => {
                    setTimeout(() => {
                        el.style.opacity = '1';
                        el.style.animation = 'slideInLeft 0.6s ease-out';
                    }, index * 100);
                });
                document.querySelectorAll('.animate-slide-up').forEach((el, index) => {
                    setTimeout(() => {
                        el.style.opacity = '1';
                        el.style.animation = 'slideInUp 0.6s ease-out';
                    }, index * 100);
                });
            }, 100);
        }

        // æ›´æ–°å•é¡Œå“è³ªåˆ†æ
        function updateCognitiveLevels(student) {
            const levelElements = document.querySelectorAll('.level-item');
            if (!levelElements || levelElements.length === 0) {
                console.warn('æ‰¾ä¸åˆ°èªçŸ¥å±¤æ¬¡å…ƒç´ ');
                return;
            }
            
            const cognitiveScore = student.èªçŸ¥æ€è€ƒåˆ†æ•¸ || 0;
            const interactionCount = student.äº’å‹•æ¬¡æ•¸ || 0;
            
            // åŸºæ–¼èªçŸ¥åˆ†æ•¸åˆ†é…å•é¡Œå±¤æ¬¡ï¼ˆæ¨¡æ“¬æ•¸æ“šï¼‰
            let levels = {
                memory: 15,
                understand: 25,
                apply: 30,
                analyze: 20,
                evaluate: 8,
                create: 2
            };
            
            // æ ¹æ“šèªçŸ¥åˆ†æ•¸èª¿æ•´åˆ†å¸ƒ
            if (cognitiveScore >= 80) {
                levels = { memory: 5, understand: 15, apply: 25, analyze: 30, evaluate: 20, create: 5 };
            } else if (cognitiveScore >= 60) {
                levels = { memory: 10, understand: 20, apply: 35, analyze: 25, evaluate: 8, create: 2 };
            }
            
            // è¨ˆç®—å¯¦éš›é¡Œæ•¸
            const totalPercentage = 100;
            const questions = {
                memory: Math.round(interactionCount * levels.memory / totalPercentage),
                understand: Math.round(interactionCount * levels.understand / totalPercentage),
                apply: Math.round(interactionCount * levels.apply / totalPercentage),
                analyze: Math.round(interactionCount * levels.analyze / totalPercentage),
                evaluate: Math.round(interactionCount * levels.evaluate / totalPercentage),
                create: Math.round(interactionCount * levels.create / totalPercentage)
            };
            
            // æ›´æ–°é¡¯ç¤º
            const levelData = [
                { count: questions.memory, percentage: levels.memory },
                { count: questions.understand, percentage: levels.understand },
                { count: questions.apply, percentage: levels.apply },
                { count: questions.analyze, percentage: levels.analyze },
                { count: questions.evaluate, percentage: levels.evaluate },
                { count: questions.create, percentage: levels.create }
            ];
            
            levelElements.forEach((el, index) => {
                if (index < levelData.length) {
                    el.style.setProperty('--percentage', `${levelData[index].percentage}%`);
                    const countElement = el.querySelector('.level-count');
                    const percentElement = el.querySelector('.level-percentage');
                    
                    if (countElement) countElement.textContent = `${levelData[index].count}é¡Œ`;
                    if (percentElement) percentElement.textContent = `${levelData[index].percentage}%`;
                }
            });
        }

        // æ›´æ–°å€‹äººåŒ–å»ºè­°
        function updatePersonalizedTips(student, engagementData) {
            const tips = document.querySelector('.personalized-tips');
            if (!tips) {
                console.warn('æ‰¾ä¸åˆ°å€‹äººåŒ–å»ºè­°å€åŸŸ');
                return;
            }
            
            const cognitiveScore = student.èªçŸ¥æ€è€ƒåˆ†æ•¸ || 0;
            
            // æ ¹æ“šå­¸ç”Ÿç‹€æ³å‹•æ…‹èª¿æ•´å»ºè­°å…§å®¹
            const firstTipTitle = tips.querySelector('.tip-card:first-child h4');
            const firstTipText = tips.querySelector('.tip-card:first-child p');
            
            if (firstTipTitle && firstTipText) {
                if (cognitiveScore < 60) {
                    firstTipTitle.textContent = 'å»ºç«‹åŸºç¤ï¼šå¾ã€Œç†è§£ã€åˆ°ã€Œæ‡‰ç”¨ã€';
                    firstTipText.textContent = 'å…ˆç¢ºä¿ç†è§£åŸºæœ¬æ¦‚å¿µï¼Œå†å˜—è©¦å¯¦éš›æ‡‰ç”¨ã€‚';
                } else if (cognitiveScore >= 80) {
                    firstTipTitle.textContent = 'æŒ‘æˆ°é€²éšï¼šå¾ã€Œåˆ†æã€åˆ°ã€Œå‰µé€ ã€';
                    firstTipText.textContent = 'æ‚¨å·²ç¶“å…·å‚™å„ªç§€çš„åˆ†æèƒ½åŠ›ï¼Œå¯ä»¥å˜—è©¦å‰µæ–°æ€è€ƒã€‚';
                }
            }
        }

        // æ›´æ–°å­¸ç¿’è·¯å¾‘
        function updateLearningPath(student, engagementData) {
            const pathTitle = document.querySelector('.path-title span:last-child');
            if (!pathTitle) {
                console.warn('æ‰¾ä¸åˆ°å­¸ç¿’è·¯å¾‘æ¨™é¡Œå…ƒç´ ');
                return;
            }
            
            const interactionCount = student.äº’å‹•æ¬¡æ•¸ || 0;
            const cognitiveScore = student.èªçŸ¥æ€è€ƒåˆ†æ•¸ || 0;
            
            if (interactionCount > 100 && cognitiveScore < 70) {
                pathTitle.textContent = 'å»ºè­°è·¯å¾‘ï¼šæå‡æ€è€ƒæ·±åº¦å‹å­¸ç¿’è€…';
            } else if (interactionCount < 50 && cognitiveScore > 70) {
                pathTitle.textContent = 'å»ºè­°è·¯å¾‘ï¼šå¢åŠ äº’å‹•é »ç‡å‹å­¸ç¿’è€…';
            } else if (interactionCount > 100 && cognitiveScore > 80) {
                pathTitle.textContent = 'å»ºè­°è·¯å¾‘ï¼šå“è¶Šä¿æŒå‹å­¸ç¿’è€…';
            }
        }

        // æª¢æŸ¥æˆå°±
        function checkAchievements(student, engagementData) {
            const achievements = [];
            
            if (engagementData.score >= 90) {
                achievements.push({
                    title: 'èªçŸ¥å¤§å¸«',
                    desc: 'èªçŸ¥åƒèˆ‡åº¦é”åˆ°90åˆ†ï¼'
                });
            }
            
            if (student.äº’å‹•æ¬¡æ•¸ >= 100) {
                achievements.push({
                    title: 'å­¸ç¿’é”äºº',
                    desc: 'äº’å‹•æ¬¡æ•¸çªç ´100æ¬¡ï¼'
                });
            }
            
            if (parseFloat(student.å®Œæˆåº¦) === 100) {
                achievements.push({
                    title: 'å®Œç¾é”æˆ',
                    desc: 'èª²ç¨‹å®Œæˆåº¦100%ï¼'
                });
            }
            
            // é¡¯ç¤ºç¬¬ä¸€å€‹æˆå°±
            if (achievements.length > 0) {
                setTimeout(() => {
                    showAchievement(achievements[0].title, achievements[0].desc);
                }, 1000);
            }
        }

        // é¡¯ç¤ºæˆå°±é€šçŸ¥
        function showAchievement(title, desc) {
            const notification = document.getElementById('achievementNotification');
            const titleElement = document.getElementById('achievementTitle');
            const descElement = document.getElementById('achievementDesc');
            
            if (!notification || !titleElement || !descElement) {
                console.warn('æˆå°±é€šçŸ¥å…ƒç´ ä¸å­˜åœ¨');
                return;
            }
            
            titleElement.textContent = title;
            descElement.textContent = desc;
            
            notification.classList.add('show');
            notification.classList.add('achievement-unlocked');
            
            // æ’­æ”¾æ…¶ç¥å‹•ç•«
            setTimeout(() => {
                notification.classList.remove('achievement-unlocked');
            }, 800);
            
            // 5ç§’å¾Œéš±è—
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        // ç™¼é€åˆ° LINE bot
        function sendToLineBot() {
            // æ–¹æ¡ˆä¸€ï¼šç›´æ¥é–‹å•Ÿ LINE ä¸¦é å¡«è¨Šæ¯
            const studentNameElement = document.getElementById('studentName');
            const studentName = studentNameElement ? studentNameElement.textContent : 'æœªçŸ¥';
            const today = new Date().toLocaleDateString('zh-TW');
            
            // æ”¶é›†åæ€å…§å®¹
            const reflections = {
                concept: prompt('é€™é€±æˆ‘å­¸åˆ°æœ€é‡è¦çš„ Python æ¦‚å¿µæ˜¯...ï¼ˆä¾‹å¦‚ï¼šç†è§£äº†å‡½æ•¸åƒæ•¸çš„å‚³éæ–¹å¼ï¼‰'),
                difficulty: prompt('æˆ‘é‡åˆ°çš„å›°é›£å’Œè§£æ±ºæ–¹æ³•...ï¼ˆä¾‹å¦‚ï¼šéè¿´å‡½æ•¸å¾ˆé›£ç†è§£ï¼Œé€éç•«åœ–è¿½è¹¤åŸ·è¡Œæµç¨‹å¾Œè±ç„¶é–‹æœ—ï¼‰'),
                nextWeek: prompt('ä¸‹é€±æˆ‘æƒ³æ·±å…¥æ¢è¨...ï¼ˆä¾‹å¦‚ï¼šæƒ³äº†è§£å¦‚ä½•ä½¿ç”¨ Python è™•ç†æª”æ¡ˆå’Œä¾‹å¤–è™•ç†ï¼‰')
            };
            
            // æª¢æŸ¥æ˜¯å¦éƒ½æœ‰å¡«å¯«
            if (reflections.concept && reflections.difficulty && reflections.nextWeek) {
                // å»ºç«‹æ ¼å¼åŒ–çš„è¨Šæ¯
                const message = 
`ğŸ“ å­¸ç¿’åæ€è¨˜éŒ„
ğŸ‘¤ å­¸ç”Ÿï¼š${studentName} (${currentStudentId})
ğŸ“… æ—¥æœŸï¼š${today}

ğŸ’¡ æœ¬é€±é‡è¦æ¦‚å¿µï¼š
${reflections.concept}

ğŸ¤” é‡åˆ°çš„å›°é›£èˆ‡è§£æ±ºï¼š
${reflections.difficulty}

ğŸ¯ ä¸‹é€±å­¸ç¿’ç›®æ¨™ï¼š
${reflections.nextWeek}

#å­¸ç¿’åæ€ #Pythonå­¸ç¿’ #è‡ªæˆ‘èª¿ç¯€å­¸ç¿’`;

                // æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨ LINE æ·±å±¤é€£çµï¼ˆæ¨è–¦ï¼‰
                const encodedMessage = encodeURIComponent(message);
                const lineURL = `https://line.me/R/msg/text/?${encodedMessage}`;
                
                // é–‹å•Ÿ LINE ä¸¦é å¡«è¨Šæ¯
                window.open(lineURL, '_blank');
                
                // åŒæ™‚å„²å­˜åˆ° Google Sheetsï¼ˆé€é Apps Scriptï¼‰
                saveReflectionToSheet(reflections);
                
                // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
                setTimeout(() => {
                    alert('åæ€å…§å®¹å·²æº–å‚™å¥½ï¼\n\nè«‹åœ¨é–‹å•Ÿçš„ LINE è¦–çª—ä¸­ï¼š\n1. é¸æ“‡è¦å‚³é€çµ¦ Python å­¸ç¿’ Bot\n2. é»æ“Šå‚³é€\n\næ‚¨çš„åæ€å°‡è¢«è¨˜éŒ„ä¸¦ç²å¾—å­¸ç¿’å»ºè­°ã€‚');
                }, 1000);
            } else {
                alert('è«‹å®Œæ•´å¡«å¯«æ‰€æœ‰åæ€å…§å®¹ã€‚');
            }
        }

        // å„²å­˜åæ€åˆ° Google Sheets
        async function saveReflectionToSheet(reflections) {
            try {
                const studentNameElement = document.getElementById('studentName');
                const studentName = studentNameElement ? studentNameElement.textContent : 'æœªçŸ¥';
                
                const response = await fetch(`${WEB_APP_URL}?action=saveReflection`, {
                    method: 'POST',
                    mode: 'no-cors', // é¿å… CORS å•é¡Œ
                    headers: {
                        'Content-Type': 'text/plain',
                    },
                    body: JSON.stringify({
                        studentId: currentStudentId,
                        studentName: studentName,
                        reflections: reflections,
                        timestamp: new Date().toISOString()
                    })
                });
                
                console.log('åæ€å·²å„²å­˜åˆ°é›²ç«¯');
            } catch (error) {
                console.error('å„²å­˜åæ€æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
            }
        }

        // æ”¯æ´ Enter éµç™»å…¥
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM å·²è¼‰å…¥å®Œæˆ');
            
            const studentInput = document.getElementById('studentInput');
            if (studentInput) {
                studentInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        handleLogin();
                    }
                });
            }
            
            // æª¢æŸ¥å¿…è¦å…ƒç´ æ˜¯å¦å­˜åœ¨
            const requiredElements = [
                'loginPage', 'adminPage', 'dashboardPage',
                'studentInput', 'loginBtn', 'loginLoading'
            ];
            
            const missingElements = requiredElements.filter(id => !document.getElementById(id));
            if (missingElements.length > 0) {
                console.error('ç¼ºå°‘å¿…è¦çš„ HTML å…ƒç´ :', missingElements);
            }
        });

        // éŒ¯èª¤è™•ç†
        window.addEventListener('error', function(e) {
            console.error('å…¨åŸŸéŒ¯èª¤:', e);
            console.error('éŒ¯èª¤è©³æƒ…:', {
                message: e.message,
                filename: e.filename,
                line: e.lineno,
                column: e.colno,
                error: e.error
            });
        });

        // è™•ç†éåŒæ­¥éŒ¯èª¤
        window.addEventListener('unhandledrejection', function(e) {
            console.error('éåŒæ­¥éŒ¯èª¤:', e);
            console.error('Promise éŒ¯èª¤:', e.reason);
        });
    </script>
</body>
</html>
